<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Event RSVP</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#f4f6f8; --muted:#7b8694; --accent:#0a66c2; --accent-2:#1b9df0;
      --radius:14px; --shadow:0 6px 24px rgba(16,24,40,0.08);
      --success:#1f9d55; --danger:#d64545;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{
      margin:0;font-family:"Inter",system-ui,-apple-system,"Segoe UI",Roboto,Arial;
      background:
        radial-gradient(800px 400px at 10% 10%, rgba(26,94,255,0.04), transparent 10%),
        var(--bg);
      display:flex;align-items:center;justify-content:center;padding:48px 20px;color:#0f1724;
    }
    .site{
      width:100%;max-width:880px;
    }
    header, footer{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.9), #fff);padding:28px;border-radius:var(--radius);box-shadow:var(--shadow)}
    form{display:grid;grid-template-columns:1fr 320px;gap:18px;align-items:start}
    @media (max-width:760px){ form{grid-template-columns:1fr}}
    label{display:flex;flex-direction:column;gap:8px;font-size:13px}
    input[type="text"], select{
      padding:12px 14px;border-radius:10px;border:1px solid #e6e9ee;background:transparent;font-size:15px;outline:none;
    }
    input[type="text"]:focus, select:focus{box-shadow:0 6px 20px rgba(10,102,194,0.08);border-color:rgba(10,102,194,0.9)}
    .aside{padding:18px;border-radius:10px;background:linear-gradient(180deg, rgba(10,102,194,0.04), rgba(255,255,255,0.2));border:1px solid rgba(12,45,95,0.04)}
    .actions{display:flex;gap:12px;justify-content:flex-end}
    .btn{padding:12px 16px;border-radius:10px;font-weight:600;cursor:pointer;border:0}
    .primary{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#fff;box-shadow:0 10px 30px rgba(13,74,148,0.12)}
    .ghost{background:transparent;border:1px solid #e6eefc;color:var(--accent)}
    .help{font-size:13px;color:var(--muted)}
    footer{margin-top:16px;color:var(--muted);font-size:13px}

    /* Notices */
    .notice{
      border-radius:10px;
      padding:12px 14px;
      margin-bottom:12px;
      display:flex;
      gap:12px;
      align-items:flex-start;
      font-size:14px;
    }
    .notice.success{
      background:linear-gradient(90deg, rgba(31,157,85,0.08), rgba(255,255,255,0.4));
      border:1px solid rgba(31,157,85,0.12);
      color:var(--success);
    }
    .notice.error{
      background:linear-gradient(90deg, rgba(214,69,69,0.06), rgba(255,255,255,0.4));
      border:1px solid rgba(214,69,69,0.12);
      color:var(--danger);
    }
    .notice .muted{color:var(--muted);font-size:13px}
    .spinner{
      width:18px;height:18px;border-radius:50%;border:2px solid rgba(0,0,0,0.08);border-top-color:rgba(10,102,194,0.9);animation:spin .9s linear infinite;
    }
    @keyframes spin{ to { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div class="site">
    <header>
      <div class="brand" role="banner">
        <div class="logo" aria-hidden="true">WS</div>
        <div>
          <div style="font-weight:600">Wine Specialists</div>
          <div class="help">Event RSVP</div>
        </div>
      </div>
      <nav aria-label="Top actions"><a href="#" class="help">Support</a></nav>
    </header>

    <main class="card" role="main" aria-labelledby="title">
      <h2 id="title" style="margin:0 0 8px">RSVP — choose your event & meal</h2>
      <p class="help" style="margin:0 0 16px">Select the event type and preferred food category below.</p>

      <!-- form: JS will handle submit and show messages -->
      <form id="rsvpForm" action="https://n8n.ksquareservices.com/webhook-test/wine" method="post" novalidate>
        <div>
          <!-- live region for feedback -->
          <div id="formMessage" aria-live="polite" aria-atomic="true"></div>

          <label for="attendee">Full name
            <input id="attendee" name="name" type="text" placeholder="Jane Doe" autocomplete="name" required>
          </label>

          <label for="event_type">Event type
            <select id="event_type" name="event_type" required>
              <option value="" disabled selected hidden>Choose an event</option>
              <option value="dinner">Dinner</option>
              <option value="lunch">Lunch</option>
              <option value="brunch">Brunch</option>
              <option value="appero">Appero</option>
            </select>
          </label>

          <label for="food_type">Type of food
            <select id="food_type" name="food_type" required>
              <option value="" disabled selected hidden>Choose food type</option>
              <option value="meat">Meat</option>
              <option value="seafood">Sea food</option>
              <option value="vegetarian">Vegetarian</option>
            </select>
          </label>

          <div class="actions" style="margin-top:12px">
            <button type="reset" class="btn ghost">Reset</button>
            <button id="submitBtn" type="submit" class="btn primary">Find the best wine</button>
          </div>
        </div>

        <aside class="aside" aria-label="Info">
          <strong>Details</strong>
          <p class="help" style="margin:6px 0 0">We'll confirm availability and any dietary accommodations after submission.</p>
          <small class="help" style="margin-top:auto">By submitting you agree to our <a href="#" class="help">privacy policy</a>.</small>
        </aside>
      </form>
    </main>

    <footer>
      <div>© <strong>Wine Specialists</strong> 2025</div>
      <div style="display:flex;gap:12px"><a class="help" href="#">Privacy</a><a class="help" href="#">Terms</a></div>
    </footer>
  </div>

  <script>
(function () {
  const form = document.getElementById('rsvpForm');
  const submitBtn = document.getElementById('submitBtn');
  const msgWrap = document.getElementById('formMessage');
  const endpoint = form.getAttribute('action');

  function setLoading(loading) {
    if (loading) {
      submitBtn.disabled = true;
      submitBtn.dataset.orig = submitBtn.textContent;
      submitBtn.innerHTML = '<span class="spinner" aria-hidden="true"></span> Sending...';
    } else {
      submitBtn.disabled = false;
      submitBtn.textContent = submitBtn.dataset.orig || 'Find the best wine';
    }
  }

  async function postForm(fd) {
    const controller = new AbortController();
    const timeout = setTimeout(() => controller.abort(), 15000);
    try {
      const res = await fetch(endpoint, {
        method: 'POST',
        body: fd,
        signal: controller.signal,
      });
      clearTimeout(timeout);
      return res;
    } catch (err) {
      clearTimeout(timeout);
      throw err;
    }
  }

  async function parseResponse(res) {
    const ct = (res.headers.get('content-type') || '').toLowerCase();
    try {
      if (ct.includes('application/json')) {
        const json = await res.json();
        return { kind: 'json', value: json };
      } else {
        const text = await res.text();
        return { kind: 'text', value: text };
      }
    } catch (err) {
      return { kind: 'text', value: '' };
    }
  }

  function escapeHtml(str) {
    return String(str).replace(/[&<>"']/g, (m) => ({
      '&': '&amp;',
      '<': '&lt;',
      '>': '&gt;',
      '"': '&quot;',
      "'": '&#39;'
    })[m]);
  }

  // Render only the webhook output in a clean, professional panel
  function renderResponseContent(parsed) {
    if (!parsed) return '';

    function jsonToHtml(val) {
      if (val === null) return '<div style="color:var(--muted);font-style:italic;">(null)</div>';
      if (typeof val === 'object') {
        if (Array.isArray(val)) {
          return '<ol style="margin:6px 0 6px 18px;padding:0;">' +
                 val.map(item => '<li style="margin-bottom:8px;">' + jsonToHtml(item) + '</li>').join('') +
                 '</ol>';
        }
        return '<div style="display:grid;gap:10px;">' +
               Object.keys(val).map(k =>
                 '<div style="border-left:2px solid #eef6ff;padding-left:10px;padding-bottom:6px;">' +
                   '<div style="font-weight:600;font-size:14px;margin-bottom:4px;color:#0f1724;">' + escapeHtml(k) + '</div>' +
                   '<div style="font-size:14px;color:#0f1724;">' + jsonToHtml(val[k]) + '</div>' +
                 '</div>'
               ).join('') +
               '</div>';
      }
      return '<div style="white-space:pre-wrap;font-size:14px;color:#0f1724;">' + escapeHtml(String(val)) + '</div>';
    }

    let contentHtml;
    if (parsed.kind === 'json') {
      contentHtml = '<div style="padding:12px;border-radius:8px;background:#fff;border:1px solid #eef6ff;margin:8px 0;font-size:14px;">' + jsonToHtml(parsed.value) + '</div>';
    } else {
      contentHtml = '<div style="padding:12px;border-radius:8px;background:#fff;border:1px solid #eef6ff;margin:8px 0;font-size:14px;">' +
                    '<div style="white-space:pre-wrap;">' + escapeHtml(parsed.value || '(no response body)') + '</div></div>';
    }

    // Panel wrapper with a succinct title (no success message)
    return '<div style="border-radius:10px;padding:14px;background:linear-gradient(180deg,#fff,#fbfdff);border:1px solid #e8f0ff;margin-top:12px;">' +
           '<div style="font-weight:600;font-size:15px;margin-bottom:8px;color:#0f1724">Webhook response</div>' +
           contentHtml +
           '<div style="font-size:12px;color:var(--muted);margin-top:6px">Shown as a structured document.</div>' +
           '</div>';
  }

  // simple notice for error/status-only cases
  function renderNotice(kind, title, detail) {
    return '<div class="notice ' + (kind === 'success' ? 'success' : 'error') + '"><div><strong style="display:block;margin-bottom:4px;">' +
           escapeHtml(title) + '</strong><div class="muted">' + escapeHtml(detail) + '</div></div></div>';
  }

  form.addEventListener('submit', async function (e) {
    e.preventDefault();

    if (!form.checkValidity()) {
      form.reportValidity();
      return;
    }

    setLoading(true);
    // sending indicator
    msgWrap.innerHTML = '<div class="notice"><div style="display:flex;align-items:center;"><span class="spinner" aria-hidden="true"></span></div><div><strong style="display:block;margin-bottom:4px;">Sending…</strong><div class="muted">Please wait while we send your selection.</div></div></div>';

    const fd = new FormData(form);

    try {
      const res = await postForm(fd);
      const parsed = await parseResponse(res);

      msgWrap.innerHTML = '';

      const bodyPresent = parsed && (
        (parsed.kind === 'json' && Object.keys(parsed.value || {}).length > 0) ||
        (parsed.kind === 'text' && String(parsed.value).trim().length > 0)
      );

      if (bodyPresent) {
        // display only the webhook response (no extra success text)
        msgWrap.innerHTML = renderResponseContent(parsed);
      } else {
        // no body: show concise status notice
        if (res.ok) {
          msgWrap.innerHTML = renderNotice('success', 'No response body', 'The webhook responded with status ' + res.status + '. No response body was returned.');
        } else {
          msgWrap.innerHTML = renderNotice('error', 'Submission failed', 'Server responded with status ' + res.status + ' ' + (res.statusText || '') + '. No response body was returned.');
        }
      }
    } catch (networkError) {
      msgWrap.innerHTML = '';
      msgWrap.innerHTML = renderNotice('error', 'Network error', 'Unable to reach the server. Details: ' + (networkError && networkError.message ? networkError.message : String(networkError)));
    } finally {
      setLoading(false);
    }
  });
})();
</script>
</body>

  })();
  </script></body></html>