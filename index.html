<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Event RSVP</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --bg:#f4f6f8; --muted:#7b8694; --accent:#0a66c2; --accent-2:#1b9df0;
      --radius:14px; --shadow:0 6px 24px rgba(16,24,40,0.08);
      --success:#1f9d55; --danger:#d64545;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{
      margin:0;font-family:"Inter",system-ui,-apple-system,"Segoe UI",Roboto,Arial;
      background:
        radial-gradient(800px 400px at 10% 10%, rgba(26,94,255,0.04), transparent 10%),
        var(--bg);
      display:flex;align-items:center;justify-content:center;padding:48px 20px;color:#0f1724;
    }
    .site{
      width:100%;max-width:880px;
    }
    header, footer{display:flex;justify-content:space-between;align-items:center;margin-bottom:18px}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:56px;height:56px;border-radius:12px;background:linear-gradient(135deg,var(--accent),var(--accent-2));display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700}
    .card{background:linear-gradient(180deg, rgba(255,255,255,0.9), #fff);padding:28px;border-radius:var(--radius);box-shadow:var(--shadow)}
    form{display:grid;grid-template-columns:1fr 320px;gap:18px;align-items:start}
    @media (max-width:760px){ form{grid-template-columns:1fr}}
    label{display:flex;flex-direction:column;gap:8px;font-size:13px}
    input[type="text"], select{
      padding:12px 14px;border-radius:10px;border:1px solid #e6e9ee;background:transparent;font-size:15px;outline:none;
    }
    input[type="text"]:focus, select:focus{box-shadow:0 6px 20px rgba(10,102,194,0.08);border-color:rgba(10,102,194,0.9)}
    .aside{padding:18px;border-radius:10px;background:linear-gradient(180deg, rgba(10,102,194,0.04), rgba(255,255,255,0.2));border:1px solid rgba(12,45,95,0.04)}
    .actions{display:flex;gap:12px;justify-content:flex-end}
    .btn{padding:12px 16px;border-radius:10px;font-weight:600;cursor:pointer;border:0}
    .primary{background:linear-gradient(90deg,var(--accent),var(--accent-2));color:#fff;box-shadow:0 10px 30px rgba(13,74,148,0.12)}
    .ghost{background:transparent;border:1px solid #e6eefc;color:var(--accent)}
    .help{font-size:13px;color:var(--muted)}
    footer{margin-top:16px;color:var(--muted);font-size:13px}

    /* Notices */
    .notice{
      border-radius:10px;
      padding:12px 14px;
      margin-bottom:12px;
      display:flex;
      gap:12px;
      align-items:flex-start;
      font-size:14px;
    }
    .notice.success{
      background:linear-gradient(90deg, rgba(31,157,85,0.08), rgba(255,255,255,0.4));
      border:1px solid rgba(31,157,85,0.12);
      color:var(--success);
    }
    .notice.error{
      background:linear-gradient(90deg, rgba(214,69,69,0.06), rgba(255,255,255,0.4));
      border:1px solid rgba(214,69,69,0.12);
      color:var(--danger);
    }
    .notice .muted{color:var(--muted);font-size:13px}
    .spinner{
      width:18px;height:18px;border-radius:50%;border:2px solid rgba(0,0,0,0.08);border-top-color:rgba(10,102,194,0.9);animation:spin .9s linear infinite;
    }
    @keyframes spin{ to { transform: rotate(360deg); } }
  </style>
</head>
<body>
  <div class="site">
    <header>
      <div class="brand" role="banner">
        <div class="logo" aria-hidden="true">WS</div>
        <div>
          <div style="font-weight:600">Wine Specialists</div>
          <div class="help">Event RSVP</div>
        </div>
      </div>
      <nav aria-label="Top actions"><a href="#" class="help">Support</a></nav>
    </header>

    <main class="card" role="main" aria-labelledby="title">
      <h2 id="title" style="margin:0 0 8px">RSVP — choose your event & meal</h2>
      <p class="help" style="margin:0 0 16px">Select the event type and preferred food category below.</p>

      <!-- form: JS will handle submit and show messages -->
      <form id="rsvpForm" action="https://n8n.ksquareservices.com/webhook-test/wine" method="post" novalidate>
        <div>
          <!-- live region for feedback -->
          <div id="formMessage" aria-live="polite" aria-atomic="true"></div>

          <label for="attendee">Full name
            <input id="attendee" name="name" type="text" placeholder="Jane Doe" autocomplete="name" required>
          </label>

          <label for="event_type">Event type
            <select id="event_type" name="event_type" required>
              <option value="" disabled selected hidden>Choose an event</option>
              <option value="dinner">Dinner</option>
              <option value="lunch">Lunch</option>
              <option value="brunch">Brunch</option>
              <option value="appero">Appero</option>
            </select>
          </label>

          <label for="food_type">Type of food
            <select id="food_type" name="food_type" required>
              <option value="" disabled selected hidden>Choose food type</option>
              <option value="meat">Meat</option>
              <option value="seafood">Sea food</option>
              <option value="vegetarian">Vegetarian</option>
            </select>
          </label>

          <div class="actions" style="margin-top:12px">
            <button type="reset" class="btn ghost">Reset</button>
            <button id="submitBtn" type="submit" class="btn primary">Find the best wine</button>
          </div>
        </div>

        <aside class="aside" aria-label="Info">
          <strong>Details</strong>
          <p class="help" style="margin:6px 0 0">We'll confirm availability and any dietary accommodations after submission.</p>
          <small class="help" style="margin-top:auto">By submitting you agree to our <a href="#" class="help">privacy policy</a>.</small>
        </aside>
      </form>
    </main>

    <footer>
      <div>© <strong>Wine Specialists</strong> 2025</div>
      <div style="display:flex;gap:12px"><a class="help" href="#">Privacy</a><a class="help" href="#">Terms</a></div>
    </footer>
  </div>

  <script>
  (function () {
    const form = document.getElementById('rsvpForm');
    const submitBtn = document.getElementById('submitBtn');
    const msgWrap = document.getElementById('formMessage');
    const endpoint = form.getAttribute('action');

    function createNotice(type, title, htmlContent) {
      const el = document.createElement('div');
      el.className = 'notice ' + (type === 'success' ? 'success' : 'error');
      el.innerHTML = '<div style="display:flex;align-items:center;"><span class="spinner" aria-hidden="true" style="display:none"></span></div><div><strong style="display:block;margin-bottom:4px;">' + title + '</strong><div class="muted">' + htmlContent + '</div></div>';
      return el;
    }

    function setLoading(loading) {
      if (loading) {
        submitBtn.disabled = true;
        submitBtn.dataset.orig = submitBtn.textContent;
        submitBtn.innerHTML = '<span class="spinner" aria-hidden="true"></span> Sending...';
      } else {
        submitBtn.disabled = false;
        submitBtn.textContent = submitBtn.dataset.orig || 'Find the best wine';
      }
    }

    async function postForm(fd) {
      const controller = new AbortController();
      const timeout = setTimeout(() => controller.abort(), 15000);
      try {
        const res = await fetch(endpoint, {
          method: 'POST',
          // custom header for authentication
          headers: {
            'ksquaresrvices': '123456789'
          },
          body: fd,
          signal: controller.signal,
        });
        clearTimeout(timeout);
        return res;
      } catch (err) {
        clearTimeout(timeout);
        throw err;
      }
    }

    async function parseResponse(res) {
      const ct = (res.headers.get('content-type') || '').toLowerCase();
      try {
        if (ct.includes('application/json')) {
          const json = await res.json();
          return { kind: 'json', value: json };
        } else {
          const text = await res.text();
          return { kind: 'text', value: text };
        }
      } catch (err) {
        return { kind: 'text', value: '' };
      }
    }

    // pretty output helper
    function renderResponseContent(parsed) {
      if (!parsed) return '';
      if (parsed.kind === 'json') {
        // escape and pretty-print JSON
        const pretty = JSON.stringify(parsed.value, null, 2);
        return '<pre style="white-space:pre-wrap;max-height:220px;overflow:auto;padding:8px;border-radius:8px;background:#fcfdff;border:1px solid #eef6ff;margin:6px 0;font-size:13px;">' +
               escapeHtml(pretty) + '</pre>';
      }
      // text or empty
      return '<pre style="white-space:pre-wrap;max-height:220px;overflow:auto;padding:8px;border-radius:8px;background:#fcfdff;border:1px solid #eef6ff;margin:6px 0;font-size:13px;">' +
             escapeHtml(String(parsed.value || '(no response body)')) + '</pre>';
    }

    // simple HTML escaper
    function escapeHtml(str) {
      return str.replace(/[&<>"']/g, (m) => ({
        '&': '&amp;',
        '<': '&lt;',
        '>': '&gt;',
        '"': '&quot;',
        "'": '&#39;'
      })[m]);
    }

    form.addEventListener('submit', async function (e) {
      e.preventDefault();

      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }

      setLoading(true);
      msgWrap.innerHTML = '';
      msgWrap.appendChild(createNotice('info', 'Sending…', 'Please wait while we send your selection.'));

      const fd = new FormData(form);

      try {
        const res = await postForm(fd);
        const parsed = await parseResponse(res);

        msgWrap.innerHTML = '';

        if (res.ok) {
          const contentHtml = renderResponseContent(parsed);
          const success = createNotice('success', 'Success — data sent to the search engine', 'Thanks. We received your choices and will follow up shortly with confirmation and recommendations.' + contentHtml);
          msgWrap.appendChild(success);
          // optionally clear form: keep commented so data is preserved unless you explicitly want a reset
          // form.reset();
        } else {
          // non-2xx: show server response body if provided
          const contentHtml = renderResponseContent(parsed);
          const err = createNotice('error', 'Submission failed — server returned ' + res.status + ' ' + (res.statusText || ''), 'There was a problem submitting your data. Please try again — your entries are preserved.' + contentHtml);
          msgWrap.appendChild(err);
        }
      } catch (networkError) {
        msgWrap.innerHTML = '';
        const err = createNotice('error', 'Network error', 'Unable to reach the server. Please check your connection and try again — your entries are preserved.');
        msgWrap.appendChild(err);
      } finally {
        setLoading(false);
      }
    });
  })();
  </script>
</body>

</html>
